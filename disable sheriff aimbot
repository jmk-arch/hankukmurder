local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = workspace.CurrentCamera

-- ==========================================
-- [설정 파트] 여기서 직접 ON/OFF를 조절하세요
-- ==========================================
local Config = {
    Enabled = false,            -- true면 켜짐, false면 꺼짐
    Prediction = 0.15634,      -- 탄속 예측값
    TargetItem = "Knife",      -- 적이 들고 있어야 하는 아이템 이름
    MaxDistance = 1000         -- 최대 사거리
}

-- 타겟 파트 변수
local TargetPart = nil 

-- 인벤토리 확인 함수
local function HasItem(player, itemName)
    if player.Character and player.Character:FindFirstChild(itemName) then
        return true
    end
    if player:FindFirstChild("Backpack") and player.Backpack:FindFirstChild(itemName) then
        return true
    end
    return false
end

-- 가장 가까운 적 찾는 함수
local function GetNearestEnemy()
    local Nearest = nil
    local MinDist = Config.MaxDistance
    local MousePos = Vector2.new(Mouse.X, Mouse.Y)

    for _, Player in pairs(Players:GetPlayers()) do
        if Player ~= LocalPlayer and Player.Character then
            local Char = Player.Character
            local Hum = Char:FindFirstChild("Humanoid")
            local Root = Char:FindFirstChild("HumanoidRootPart")

            -- 살아있고 + 특정 아이템을 가졌는지 확인
            if Hum and Hum.Health > 0 and HasItem(Player, Config.TargetItem) and Root then
                local ScreenPos, OnScreen = Camera:WorldToViewportPoint(Root.Position)

                if OnScreen then
                    local Dist = (MousePos - Vector2.new(ScreenPos.X, ScreenPos.Y)).Magnitude
                    if Dist < MinDist then
                        MinDist = Dist
                        Nearest = Root
                    end
                end
            end
        end
    end
    return Nearest
end

-- 실행 루프
RunService.RenderStepped:Connect(function()
    -- Config.Enabled 가 true 일 때만 작동
    if Config.Enabled then
        TargetPart = GetNearestEnemy()

        if TargetPart then
            -- 예측 위치 계산 및 카메라 고정
            local PredictedPos = TargetPart.Position + (TargetPart.Velocity * Config.Prediction)
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, PredictedPos)
        end
    else
        TargetPart = nil
    end
end)
